#!/usr/bin/env python
from os import system, WEXITSTATUS
from numpy import array

class CMDCLR:
    HEADER, OKBLUE, OKGREEN = '\033[95m', '\033[94m', '\033[92m'
    WARNING, FAIL, ENDC = '\033[93m', '\033[91m', '\033[0m'
    BOLD, UNDERLINE = '\033[1m', '\033[4m'

def process_output(output_file='output.txt'):
    open_output_file = open(output_file)
    for row in open_output_file:
        row = array([float(ele) for ele in row.strip('\n').split(',')])
        _print_output(row[0], row[1], row[2], row[4])

def _print_output(a, b, x, c):
    """
    this function is responsible for printing the results generated by the c
    addf function where:
        > a = the first operand from the file
        > b = the first operand from the file
        > c = the result computed by c = a + b
        > x = the result computed by the addf function
    this function also prints the absolute error between the c computed value
    and the value computed by addf by the following fomula:
    abs_error = |xc - xa|, where: > xc = the computed value(computed by addf)
                                  > xa = the actual value (computed by c)
    """
    absolute_error = lambda addf_c, c_res: abs(addf_c - c_res)
    abserr = absolute_error(x, c)
    warn = (CMDCLR.FAIL,'BAD') if abserr > 0.000099 else (CMDCLR.OKGREEN,'OKAY')
    print('{:30.10f} \t+ {:20.8f} ='.format(a, b)),
    print(CMDCLR.HEADER+'(x_addf, x_c)'+CMDCLR.ENDC+' ->> '),
    print(CMDCLR.OKBLUE+'({:20.8f}'.format(x)),
    print(','+CMDCLR.BOLD+CMDCLR.OKBLUE+'{:20.8f})'.format(c)),
    print(CMDCLR.WARNING+'\t|xc-xa| = {:.8f}\t'.format(abserr)+CMDCLR.ENDC),
    print(CMDCLR.BOLD+warn[0]+warn[1]+CMDCLR.ENDC)

if __name__ == '__main__':
    system('rm tut6')
    if WEXITSTATUS(system('make clean&&make all')) == 0:
        system('clear')
        system('./fadd ../test/test_cases.txt > output.txt')
        process_output()
        system('rm output.txt')
    else:
        print(CMDCLR.BOLD+CMDCLR.FAIL+\
              'BAD COMPILE: FIX the errors and recompile'+\
              CMDCLR.OKGREEN+' tutorial06.c')
else:
    from sys import exit
    exit('USAGE: ./compile')
